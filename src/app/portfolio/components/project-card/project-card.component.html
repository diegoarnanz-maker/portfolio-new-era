<div
  class="relative shadow-lg dark:shadow-[0_0_30px_rgba(59,130,246,0.15)] h-full overflow-hidden"
>
  <!-- Barra superior con controles -->
  <div
    class="w-full h-8 bg-action-light-default/90 dark:bg-white/10 rounded-t-xl relative flex items-center justify-between px-2"
  >
    <!-- Botones de selección de imagen -->
    @if (shouldShowDeviceControls()) {
    <div class="flex gap-1">
      <button
        (click)="selectImageType('desktop')"
        [class]="
          'w-6 h-6 sm:w-5 sm:h-5 rounded border transition-all duration-200 flex items-center justify-center ' +
          (selectedImageType === 'desktop'
            ? 'bg-white border-white/80 shadow-[0_0_8px_rgba(255,255,255,0.6)] text-action-light-default dark:bg-cyan-400 dark:border-cyan-300 dark:shadow-[0_0_8px_rgba(34,211,238,0.6)] dark:text-black'
            : 'bg-white/20 border-white/30 hover:bg-white/30 text-white dark:bg-gray-600 dark:border-gray-500 dark:hover:bg-gray-500 dark:text-gray-300')
        "
        [title]="'projectCard.devices.desktop' | translate"
      >
        <svg class="w-3.5 h-3.5 sm:w-3 sm:h-3" fill="currentColor" viewBox="0 0 24 24">
          <path
            d="M21 2H3c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h7l-2 3v1h8v-1l-2-3h7c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 12H3V4h18v10z"
          />
        </svg>
      </button>

      <button
        (click)="selectImageType('tablet')"
        [class]="
          'w-6 h-6 sm:w-5 sm:h-5 rounded border transition-all duration-200 flex items-center justify-center ' +
          (selectedImageType === 'tablet'
            ? 'bg-white border-white/80 shadow-[0_0_8px_rgba(255,255,255,0.6)] text-action-light-default dark:bg-cyan-400 dark:border-cyan-300 dark:shadow-[0_0_8px_rgba(34,211,238,0.6)] dark:text-black'
            : 'bg-white/20 border-white/30 hover:bg-white/30 text-white dark:bg-gray-600 dark:border-gray-500 dark:hover:bg-gray-500 dark:text-gray-300')
        "
        [title]="'projectCard.devices.tablet' | translate"
      >
        <svg class="w-3.5 h-3.5 sm:w-3 sm:h-3" fill="currentColor" viewBox="0 0 24 24">
          <path
            d="M19 1H5c-1.1 0-2 .9-2 2v18c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V3c0-1.1-.9-2-2-2zm0 18H5V5h14v14z"
          />
        </svg>
      </button>

      <button
        (click)="selectImageType('mobile')"
        [class]="
          'w-6 h-6 sm:w-5 sm:h-5 rounded border transition-all duration-200 flex items-center justify-center ' +
          (selectedImageType === 'mobile'
            ? 'bg-white border-white/80 shadow-[0_0_8px_rgba(255,255,255,0.6)] text-action-light-default dark:bg-cyan-400 dark:border-cyan-300 dark:shadow-[0_0_8px_rgba(34,211,238,0.6)] dark:text-black'
            : 'bg-white/20 border-white/30 hover:bg-white/30 text-white dark:bg-gray-600 dark:border-gray-500 dark:hover:bg-gray-500 dark:text-gray-300')
        "
        [title]="'projectCard.devices.mobile' | translate"
      >
        <svg class="w-3.5 h-3.5 sm:w-3 sm:h-3" fill="currentColor" viewBox="0 0 24 24">
          <path
            d="M16 1H8C6.34 1 5 2.34 5 4v16c0 1.66 1.34 3 3 3h8c1.66 0 3-1.34 3-3V4c0-1.66-1.34-3-3-3zm1 17H7V4h10v14z"
          />
        </svg>
      </button>
    </div>
    } @else if (project.category === 'ia_assistants') {
    <!-- Indicadores para proyectos de IA -->
    <div class="flex gap-1">
      <div
        class="px-2 py-0.5 rounded border bg-white border-white/80 shadow-[0_0_8px_rgba(255,255,255,0.6)] text-action-light-default dark:bg-cyan-400 dark:border-cyan-300 dark:shadow-[0_0_8px_rgba(34,211,238,0.6)] dark:text-black text-xs font-bold tracking-wider"
      >
        {{ getIAAssistantLabel() }}
      </div>
    </div>
    } @else {
    <!-- Indicador de subcategoría para proyectos backend -->
    <div class="flex gap-1">
      <div
        class="px-2 py-0.5 rounded border bg-white border-white/80 shadow-[0_0_8px_rgba(255,255,255,0.6)] text-action-light-default dark:bg-cyan-400 dark:border-cyan-300 dark:shadow-[0_0_8px_rgba(34,211,238,0.6)] dark:text-black text-xs font-bold tracking-wider"
      >
        {{
          project.subcategory === "API"
            ? "API REST"
            : project.subcategory || "BACKEND"
        }}
      </div>
    </div>
    }

    <!-- Indicadores LED -->
    <div class="flex gap-1">
      @if (project.category === 'ia_assistants') {
      <div
        class="w-2 h-2 rounded-full bg-green-400 animate-pulse shadow-[0_0_8px_rgba(34,197,94,0.6)]"
      ></div>
      <div
        class="w-2 h-2 rounded-full bg-blue-400 animate-pulse delay-300 shadow-[0_0_8px_rgba(59,130,246,0.6)]"
      ></div>
      <div
        class="w-2 h-2 rounded-full bg-cyan-400 animate-pulse delay-500 shadow-[0_0_8px_rgba(34,211,238,0.6)]"
      ></div>
      } @else {
      <div
        class="w-2 h-2 rounded-full bg-green-400 animate-pulse shadow-[0_0_8px_rgba(34,197,94,0.6)]"
      ></div>
      <div
        class="w-2 h-2 rounded-full bg-blue-400 animate-pulse delay-300 shadow-[0_0_8px_rgba(59,130,246,0.6)]"
      ></div>
      <div
        class="w-2 h-2 rounded-full bg-cyan-400 animate-pulse delay-500 shadow-[0_0_8px_rgba(34,211,238,0.6)]"
      ></div>
      }
    </div>
  </div>

  <!-- Área de imagen del proyecto -->
  <div
    class="group relative h-56 overflow-hidden cursor-pointer bg-background-light/90 dark:bg-background-card/80"
    (click)="openProjectModal()"
  >
    <img
      [src]="getCurrentImageUrl()"
      [alt]="('projectCard.alt.projectImage' | translate: {title: project.title}) + ' - ' + (('projectCard.devices.' + selectedImageType) | translate)"
      class="w-full h-full object-contain object-center brightness-90 sm:group-hover:brightness-100 transition-all duration-300"
      (error)="onImageError($event)"
    />
    <div
      class="absolute inset-0 bg-gradient-to-t from-gray-300/30 via-transparent to-transparent dark:bg-gradient-to-t dark:from-black/50 dark:via-transparent dark:to-transparent"
    ></div>

    <div
      class="absolute inset-0 bg-black/0 sm:group-hover:bg-black/50 transition-all duration-300 flex items-center justify-center"
    >
      <div
        class="bg-white/20 backdrop-blur-sm rounded-full p-3 opacity-0 sm:group-hover:opacity-100 transform scale-75 sm:group-hover:scale-100 transition-all duration-300"
      >
        <svg
          class="w-6 h-6 text-white"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"
          />
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"
          />
        </svg>
      </div>
    </div>
  </div>

  <!-- Información del proyecto -->
  <div
    class="p-4 bg-background-light/90 dark:bg-background-card/80 backdrop-blur-sm rounded-b-xl"
  >
    <h3
      class="text-base text-text-light dark:text-text-base font-semibold mb-2 tracking-wide uppercase line-clamp-1"
    >
      {{ project.title }}
    </h3>

    <!-- Tecnologías -->
    <div class="mb-3 relative">
      <!-- Contenedor principal que se expande -->
      <div
        class="flex flex-wrap gap-1"
        [ngClass]="{
          'max-h-8 overflow-hidden': !technologiesExpanded && !isMobile(),
          'max-h-96': technologiesExpanded && !isMobile(),
          'transition-all duration-500 ease-in-out': !isMobile()
        }"
        (mouseleave)="onHoverEnd()"
      >
        @for (tech of getVisibleTechnologies(); track tech.name) {
        <span
          class="px-2 py-1 text-xs font-medium bg-text-accent/10 dark:bg-text-accent/20 text-text-accent border border-text-accent/20 rounded-full whitespace-nowrap flex-shrink-0"
        >
          {{ tech.name }}
        </span>
        } @if (hasHiddenTechnologies() && !technologiesExpanded) {
        <span
          class="px-2 py-1 text-xs font-medium bg-text-muted/10 dark:bg-text-muted/20 text-text-muted border border-text-muted/20 rounded-full whitespace-nowrap flex-shrink-0 cursor-pointer hover:bg-text-muted/20 dark:hover:bg-text-muted/30 hover:scale-105 transition-all duration-300 ease-in-out"
          (mouseenter)="onHoverStart()"
        >
          {{ 'projectCard.technologies.more' | translate: {count: project.technologies.length - getMaxVisibleTechnologies()} }}
        </span>
        }
      </div>
    </div>

    <!-- Botones de acción -->
    <div class="flex gap-2">
      @if (project.githubUrl) {
      <a
        [href]="project.githubUrl"
        target="_blank"
        class="flex items-center justify-center gap-1 px-3 py-2 text-xs font-medium text-action-light-hover dark:text-text-base border border-action-light-default/30 dark:border-border-base transition-all duration-300 flex-1 hover:bg-action-light-default/10 dark:hover:bg-action-default/5 hover:border-action-light-default/50 dark:hover:border-action-default/30 rounded h-8"
      >
        <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 24 24">
          <path
            d="M12 0C5.37 0 0 5.373 0 12c0 5.302 
              3.438 9.8 8.207 11.387.6.111.793-.261.793-.577 
              v-2.234c-3.338.726-4.033-1.416-4.033-1.416 
              -.546-1.387-1.333-1.756-1.333-1.756 
              -1.089-.745.083-.729.083-.729 
              1.205.084 1.839 1.237 1.839 1.237 
              1.07 1.834 2.807 1.304 3.492.997 
              .107-.775.418-1.305.762-1.604 
              -2.665-.305-5.467-1.334-5.467-5.931 
              0-1.311.469-2.381 1.236-3.221 
              -.124-.303-.535-1.524.117-3.176 
              0 0 1.008-.322 3.301 1.23 
              .957-.266 1.983-.399 3.003-.404 
              1.02.005 2.047.138 3.006.404 
              2.291-1.552 3.297-1.30 3.297-1.30 
              .653 1.653.242 2.874.118 3.176 
              .77.84 1.235 1.911 1.235 3.221 
              0 4.609-2.807 5.624-5.479 5.921 
              .43.372.823 1.102.823 2.222v3.293 
              c0 .319.192.694.801.576C20.565 21.8 24 17.302 24 12 
              c0-6.627-5.373-12-12-12z"
          />
        </svg>
        {{ 'projectCard.buttons.viewCode' | translate }}
      </a>
      } @if (usesPython() && getDemoUrl()) {
      <a
        [href]="getDemoUrl()"
        target="_blank"
        class="flex items-center justify-center gap-1 px-3 py-2 text-xs font-medium text-action-light-hover dark:text-text-base border border-action-light-default/30 dark:border-border-base transition-all duration-300 flex-1 hover:bg-action-light-default/10 dark:hover:bg-action-default/5 hover:border-action-light-default/50 dark:hover:border-action-default/30 rounded h-8"
      >
        <svg
          class="w-3 h-3"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"
          />
        </svg>
        {{ getDemoButtonText() }}
      </a>
      }

      <button
        (click)="openProjectModal()"
        class="flex items-center justify-center gap-1 px-2 py-2 text-xs font-medium text-white bg-gradient-to-r from-action-light-gradient-from to-action-light-gradient-to dark:from-action-gradient-from dark:to-action-gradient-to hover:from-action-light-hover hover:to-action-light-default dark:hover:from-action-hover dark:hover:to-action-default transition-all duration-300 shadow-md hover:shadow-glow rounded h-8 flex-1 [text-shadow:0_0_3px_rgba(0,0,0,0.7),1px_1px_1px_rgba(0,0,0,0.5)] dark:[text-shadow:none]"
      >
        <svg
          class="w-3 h-3"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"
          />
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"
          />
        </svg>
        {{ 'projectCard.buttons.viewProject' | translate }}
      </button>
    </div>
  </div>
</div>
